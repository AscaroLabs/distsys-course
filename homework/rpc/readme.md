# Реализация RPC

В этой задаче Вам надо реализовать механизм удаленных вызовов процедур (RPC),
позволяющий клиенту вызывать функции сервиса, размещенного на сервере. В
качестве примера сервиса используется простое key-value хранилище. Реализация
RPC состоит из клиентской и серверной частей.

## Клиент и сервер

Клиент взаимодействует с сервисом через локальный прокси-объект, который
делегирует вызовы клиентской части RPC. Клиентская часть должна упаковать
параметры запроса, отправить его серверу, дождаться ответа от сервера,
распаковать его и вернуть результат вызова прокси. Как упаковывать -- решать
Вам, но мы советуем это сделать с помощью встроенной в python библиотеки json.

Всего нужно реализовать 4 вызова:

```python
@abc.abstractmethod
def put(self, key, value, overwrite):
    """Stores the value under the specified key.
    If key exists and overwrite is False, key is not updated.
    Returns True is key is updated, False otherwise.
    """
    pass

@abc.abstractmethod
def get(self, key):
    """Returns the key value.
    Throws error if key does not exist.
    """
    pass

@abc.abstractmethod
def append(self, key, value):
    """Appends the given value to the key value.
    Returns the updated key value or throws error if key does not exist.
    """
    pass

@abc.abstractmethod
def remove(self, key):
    """Removes and returns the given key.
    Throws error if key does not exist.
    """
    pass
```

Сервер при запуске снабжается реализацией сервиса, которой он делегирует
обработку приходящих по сети вызовов. Сервер должен распаковывать запросы,
транслировать их в вызовы функций сервиса, упаковывать и отправлять результаты
вызовов клиенту.

Реализация должна перехватывать и передавать клиенту возникающие при вызове
сервиса исключения. Локальный тестировщик должен получить сообщение типа
"ERROR" на брошенное исключение. Если это не будет реализовано, штраф будет в
2 балла.

Реализация должна по-умолчанию обеспечивать гарантию at most once и выбрасывать
исключение на клиентской стороне, если не удалось в течение таймаута получить
результат вызова. Для идемпотентных функций (например, get) должен быть
предусмотрен режим автоматических retry. Если это не реализовано, будет штраф
в 2 балла.

Если будут реализованы только части функций или будут реализованы неправильно,
то за каждую неправильную функцию штраф будет в 1.5 балла.

## Тестирование

Установите необходимые зависимости:

```console
$ pip3 install -r requirements.txt
```

__Добавьте корень репозитория в переменную окружения PYTHONPATH и можете
запустить, например__:

```console
$ PYTHONPATH=$ROOT_DIRECTORY_PATH python3 test.py solution
```

Если Вам нужна бОльшая debug информация, добавьте флаг `-d` к тестированию. Если
Вам хочется прогнать тесты несколько раз, укажите число после флага `-n`.

Поднимаются три процесса -- `sender`, `receiver` и `test_server`, между ними происходит
коммуникация. Все аналогично первой задаче.

Мы уже написали за Вас тесты, которы должны проходить при правильном решении.
Вы можете добавлять новые тесты, по умолчанию они не будут оцениваться.
Однако если вы придумаете и реализуете тест, который увеличит покрытие наших тестов, то за него можно получить бонус 2 балла.
За деталями о том, как мы тестируем, обращайтесь к тестам, осознать, что там происходит -- Ваша задача.

## Оценка

Задача состоит из 6 пунктов -- реализация 4 функций, каждая из которых оценивается
в 1.5 балла, проброс исключений, который оценивается в 2 балла и retry
идемпотентных функций, который оценивается также в 2 балла. Оценка
округляется арифметически.

## Сдача

Сдача и проверка решений будет вестись через сервис Gradescope.
См. инструкцию в первой задаче.

Далее зайдите в Assignments, там вы увидите задачу RPC, в которую можно
сдавать только zip архивы. Поместите тесты и решение в архив следующей командой:

```console
$ zip -r solution.zip test.py solution/
```

Желательно также добавить в папку `solution` файл `readme.md` с кратким описанием
вашего решения и дополнительными комментариями, который также попадет в архив.

Далее сдайте Ваш `solution.zip`. Дождитесь пока отработают Ваши тесты на Вашем решении
(учтите, что это может занять несколько минут из-за нагрузки серверов). Если все тесты
прошли успешно, то решение проставляется 2 балла и решение принимается на ручную проверку.
Если какие-то тесты не прошли, то выставляется 0 баллов, и решение не принимается на
ручную проверку.

Если Вы не смогли что-то реализовать, можете закомментировать некоторые тесты в [test.py](./test.py),
но обязательно отразите почему Вы это сделали в readme-файле. Это сильно упростит нам проверку.

Дедлайн задачи -- __2 недели__, в Gradescope корректно проставлена дата
окончания.
